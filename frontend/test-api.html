<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ»ç–—AIæ¥å£æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-title {
            color: #1658FF;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: bold;
        }
        textarea, input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }
        button {
            background-color: #1658FF;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background-color: #0d47e6;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .result {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-top: 15px;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 300px;
            overflow-y: auto;
        }
        .error {
            background-color: #fff5f5;
            color: #e53e3e;
            border: 1px solid #feb2b2;
        }
        .success {
            background-color: #f0fff4;
            color: #38a169;
            border: 1px solid #9ae6b4;
        }
        .loading {
            color: #1658FF;
            font-style: italic;
        }
    </style>
</head>
<body>
    <h1>ğŸ¥ åŒ»ç–—AIæ¥å£æµ‹è¯•</h1>
    <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•å‰ç«¯åˆ°åç«¯çš„APIè¿æ¥æ˜¯å¦æ­£å¸¸</p>

    <!-- å¥åº·æ£€æŸ¥ -->
    <div class="test-section">
        <div class="test-title">1. å¥åº·æ£€æŸ¥</div>
        <button onclick="testHealth()">æµ‹è¯•åç«¯è¿æ¥</button>
        <div id="health-result" class="result" style="display: none;"></div>
    </div>

    <!-- åŒ»ç–—èŠå¤© -->
    <div class="test-section">
        <div class="test-title">2. åŒ»ç–—èŠå¤©æµ‹è¯•</div>
        <textarea id="chat-input" placeholder="è¾“å…¥æ‚¨çš„å¥åº·é—®é¢˜..." rows="3">æˆ‘å¤´ç—›å‘çƒ§ï¼Œåº”è¯¥çœ‹ä»€ä¹ˆç§‘ï¼Ÿ</textarea>
        <button onclick="testChat()">å‘é€æ¶ˆæ¯</button>
        <div id="chat-result" class="result" style="display: none;"></div>
    </div>

    <!-- å¥åº·ç§‘æ™® -->
    <div class="test-section">
        <div class="test-title">3. å¥åº·ç§‘æ™®æµ‹è¯•</div>
        <input type="text" id="health-input" placeholder="è¾“å…¥å¥åº·é—®é¢˜..." value="é«˜è¡€å‹çš„é¢„é˜²æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ">
        <button onclick="testHealthEducation()">æŸ¥è¯¢ç§‘æ™®</button>
        <div id="health-edu-result" class="result" style="display: none;"></div>
    </div>

    <!-- è¯ç‰©å’¨è¯¢ -->
    <div class="test-section">
        <div class="test-title">4. è¯ç‰©å’¨è¯¢æµ‹è¯•</div>
        <input type="text" id="medication-input" placeholder="è¾“å…¥è¯ç‰©é—®é¢˜..." value="é˜¿è«è¥¿æ—èƒ¶å›Šçš„ç”¨æ³•ç”¨é‡æ˜¯ä»€ä¹ˆï¼Ÿ">
        <button onclick="testMedication()">å’¨è¯¢è¯ç‰©</button>
        <div id="medication-result" class="result" style="display: none;"></div>
    </div>

    <!-- æ–‡ä»¶ä¸Šä¼ æµ‹è¯• -->
    <div class="test-section">
        <div class="test-title">5. æŠ¥å‘Šè§£è¯»æµ‹è¯•</div>
        <input type="file" id="file-input" accept=".txt,.pdf,.doc,.docx">
        <button onclick="testReportUpload()">ä¸Šä¼ å¹¶è§£è¯»</button>
        <div id="report-result" class="result" style="display: none;"></div>
    </div>

    <!-- å›¾ç‰‡ä¸Šä¼ æµ‹è¯• -->
    <div class="test-section">
        <div class="test-title">6. çš®è‚¤ç—…å’¨è¯¢æµ‹è¯•</div>
        <input type="file" id="image-input" accept="image/*">
        <textarea id="symptoms-input" placeholder="æè¿°çš®è‚¤ç—‡çŠ¶..." rows="2">çš®è‚¤å‘çº¢ï¼Œæœ‰ç‚¹ç—’ï¼Œå‡ºç°äº†ä¸€ä¸ªçº¢è‰²çš„åœ†å½¢æ–‘å—</textarea>
        <button onclick="testDermatology()">ä¸Šä¼ å›¾ç‰‡åˆ†æ</button>
        <div id="dermatology-result" class="result" style="display: none;"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000/api'; // é€šè¿‡viteä»£ç†

        function showResult(elementId, content, isError = false, isLoading = false) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `result ${isError ? 'error' : isLoading ? 'loading' : 'success'}`;
            element.textContent = content;
        }

        async function testHealth() {
            showResult('health-result', 'æ­£åœ¨æ£€æŸ¥åç«¯è¿æ¥...', false, true);
            try {
                const response = await fetch(`${API_BASE}/health`);
                const data = await response.json();
                showResult('health-result', JSON.stringify(data, null, 2));
            } catch (error) {
                showResult('health-result', `è¿æ¥å¤±è´¥: ${error.message}`, true);
            }
        }

        async function testChat() {
            const input = document.getElementById('chat-input').value.trim();
            if (!input) {
                showResult('chat-result', 'è¯·è¾“å…¥æ¶ˆæ¯å†…å®¹', true);
                return;
            }

            showResult('chat-result', 'æ­£åœ¨å‘é€æ¶ˆæ¯...', false, true);
            try {
                const response = await fetch(`${API_BASE}/medical-chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message: input })
                });
                const data = await response.json();
                showResult('chat-result', JSON.stringify(data, null, 2));
            } catch (error) {
                showResult('chat-result', `è¯·æ±‚å¤±è´¥: ${error.message}`, true);
            }
        }

        async function testHealthEducation() {
            const input = document.getElementById('health-input').value.trim();
            if (!input) {
                showResult('health-edu-result', 'è¯·è¾“å…¥é—®é¢˜', true);
                return;
            }

            showResult('health-edu-result', 'æ­£åœ¨æŸ¥è¯¢å¥åº·ç§‘æ™®...', false, true);
            try {
                const response = await fetch(`${API_BASE}/health-education`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ question: input })
                });
                const data = await response.json();
                showResult('health-edu-result', JSON.stringify(data, null, 2));
            } catch (error) {
                showResult('health-edu-result', `è¯·æ±‚å¤±è´¥: ${error.message}`, true);
            }
        }

        async function testMedication() {
            const input = document.getElementById('medication-input').value.trim();
            if (!input) {
                showResult('medication-result', 'è¯·è¾“å…¥è¯ç‰©é—®é¢˜', true);
                return;
            }

            showResult('medication-result', 'æ­£åœ¨å’¨è¯¢è¯ç‰©...', false, true);
            try {
                const response = await fetch(`${API_BASE}/medication-consultation`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ question: input })
                });
                const data = await response.json();
                showResult('medication-result', JSON.stringify(data, null, 2));
            } catch (error) {
                showResult('medication-result', `è¯·æ±‚å¤±è´¥: ${error.message}`, true);
            }
        }

        async function testReportUpload() {
            const fileInput = document.getElementById('file-input');
            const file = fileInput.files[0];
            if (!file) {
                showResult('report-result', 'è¯·é€‰æ‹©æ–‡ä»¶', true);
                return;
            }

            showResult('report-result', 'æ­£åœ¨ä¸Šä¼ å’Œè§£è¯»æŠ¥å‘Š...', false, true);
            try {
                const formData = new FormData();
                formData.append('file', file);

                const response = await fetch(`${API_BASE}/report-interpretation`, {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                showResult('report-result', JSON.stringify(data, null, 2));
            } catch (error) {
                showResult('report-result', `ä¸Šä¼ å¤±è´¥: ${error.message}`, true);
            }
        }

        async function testDermatology() {
            const fileInput = document.getElementById('image-input');
            const file = fileInput.files[0];
            const symptoms = document.getElementById('symptoms-input').value.trim();
            
            if (!file) {
                showResult('dermatology-result', 'è¯·é€‰æ‹©å›¾ç‰‡', true);
                return;
            }

            showResult('dermatology-result', 'æ­£åœ¨ä¸Šä¼ å’Œåˆ†æå›¾ç‰‡...', false, true);
            try {
                const formData = new FormData();
                formData.append('file', file);
                formData.append('symptoms', symptoms);

                const response = await fetch(`${API_BASE}/dermatology-consultation`, {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                showResult('dermatology-result', JSON.stringify(data, null, 2));
            } catch (error) {
                showResult('dermatology-result', `ä¸Šä¼ å¤±è´¥: ${error.message}`, true);
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æµ‹è¯•å¥åº·æ£€æŸ¥
        window.onload = function() {
            testHealth();
        };
    </script>
</body>
</html>
